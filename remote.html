
<html><head>
<script>

var freq = 0;
var tx_vfo = 0;
var base_url = "http://my.web.server:7388";


function powerOn() {
	var rReq = new XMLHttpRequest();
	rReq.addEventListener("load", toggleListener);
	rReq.open("GET", base_url + "/ps1");
	rReq.send();
}

function bandUp() {
	var rReq = new XMLHttpRequest();
	rReq.open("GET", base_url + "/bu");
	rReq.send();
}

function bandDown() {
	var rReq = new XMLHttpRequest();
	rReq.open("GET", base_url + "/bd");
	rReq.send();
}

function cloneVFO() {
	var rReq = new XMLHttpRequest();
	rReq.open("GET", base_url + "/vv");
	rReq.send();
}

function ready() {
	document.getElementById("scrollDivA").addEventListener("mousewheel", MouseWheelHandlerA, false);
	document.getElementById("scrollDivB").addEventListener("mousewheel", MouseWheelHandlerB, false);
}

function freqListener () {
	vfos = this.responseText.split(';');
	freq = parseInt(vfos[1]);
	document.getElementById("scrollDivA").innerHTML = numberWithSpaces(parseInt(vfos[0]));
	document.getElementById("scrollDivB").innerHTML = numberWithSpaces(freq);
}

function toggleListener () {
	if (this.responseText == 'TXA') {
		tx_vfo = 0;
		document.getElementById("vfoInfo").innerHTML = "<font color='red'>VFO A = TX<br />VFO B = RX</font>";
	} else {
		tx_vfo = 1;
		document.getElementById("vfoInfo").innerHTML = "<font color='green'>VFO A = RX<br />VFO B = TX</font>";
	}
}

function tuneListener () {
        swr = this.responseText
        if (swr[0] == '1') {
            document.getElementById("swrColor").innerHTML = "<font color='green'>SWR</font>";
        } else {
            document.getElementById("swrColor").innerHTML = "<font color='red'>SWR</font>";
        }
        document.getElementById("swrInfo").innerHTML = swr + ':1';
}

function MouseWheelHandlerA(evt) {
	//console.log(evt.deltaY);
	freq += evt.deltaY;
	freq = parseInt(freq);
	document.getElementById("scrollDivA").innerHTML = numberWithSpaces(freq);

	paddedFreq = pad(freq,11);
	var fReq = new XMLHttpRequest();
	fReq.open("GET", base_url + "/s?fa=" + paddedFreq);
	fReq.send();

}


function MouseWheelHandlerB(evt) {
	//console.log(evt.deltaY);
	freq += evt.deltaY;
	freq = parseInt(freq);
	document.getElementById("scrollDivB").innerHTML = numberWithSpaces(freq);

	paddedFreq = pad(freq,11);
	var fReq = new XMLHttpRequest();
	fReq.open("GET", base_url + "/s?fb=" + paddedFreq);
	fReq.send();

}

function pad(num, size) {
    var s = num+"";
    while (s.length < size) s = "0" + s;
    return s;
}

function numberWithSpaces(x) {
	// could also use str.toLocaleString() if I wanted commas
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
}

function CWSpeed() {
        cwSpeedString = document.getElementById('speed').value
        cwspeed = parseInt(cwSpeedString);
	if (cwspeed > 60) {
		alert('The speed limit is 60, Hot Rod!');
		return;
	}
	var rReq = new XMLHttpRequest();
	rReq.open("GET", base_url + "/c?s=" + cwspeed);
	rReq.send();
}

function SetVFOA() {
        VFOAString = document.getElementById('setVFOA').value
        vfoa = parseInt(VFOAString);
	paddedFreq = pad(vfoa,11);
	var fReq = new XMLHttpRequest();
	fReq.open("GET", base_url + "/s?fa=" + paddedFreq);
	fReq.send();
}

function SetVFOB() {
        VFOBString = document.getElementById('setVFOB').value
        vfob = parseInt(VFOBString);
	paddedFreq = pad(vfob,11);
	var fReq = new XMLHttpRequest();
	fReq.open("GET", base_url + "/s?fb=" + paddedFreq);
	fReq.send();
}

function sendCall() {
	if (tx_vfo == 0) {
		alert('Check your VFO, dumbass!');
		return;
	}
	var rReq = new XMLHttpRequest();
	rReq.open("GET", base_url + "/k?s=" + document.getElementById('call').value);
	rReq.send();
}

function sendReport() {
	if (tx_vfo == 0) {
		alert('Check your VFO, dumbass!');
		return;
	}
	var rReq = new XMLHttpRequest();
	rReq.open("GET", base_url + "/k?s=" + document.getElementById('report').value);
	rReq.send();
}

function cancelCW() {
        var rReq = new XMLHttpRequest();
        rReq.open("GET", base_url + "/k?s=");
        rReq.send();
}

function toggleVFO() {
	var rReq = new XMLHttpRequest();
	rReq.addEventListener("load", toggleListener);
	rReq.open("GET", base_url + "/v");
	rReq.send();
}

function toggleVox() {
	var rReq = new XMLHttpRequest();
	rReq.open("GET", base_url + "/x");
	rReq.send();
}

function toggleCWR() {
	var rReq = new XMLHttpRequest();
	rReq.open("GET", base_url + "/r");
	rReq.send();
}

function tune() {
	var tReq = new XMLHttpRequest();
	tReq.addEventListener("load", tuneListener);
	tReq.open("GET", base_url + "/t");
	tReq.send();
}

function refresh() {
	var oReq = new XMLHttpRequest();
	oReq.addEventListener("load", freqListener);
	oReq.open("GET", base_url + "/f");
	oReq.send();
}

document.onkeyup = function(e) {
	if (document.activeElement == document.getElementById('call')) {
		return; //don't capture key presses when we're editing the text fields
	}
	if (document.activeElement == document.getElementById('report')) {
		return; // ditto
	}
	if(e.keyCode == 32) {
		toggleVFO();
	} else if (e.keyCode == 67) {
		sendCall();
	} else if (e.keyCode == 82) {
		sendReport();
	} else if (e.keyCode == 27) {
                cancelCW();
	}
}

var oReq = new XMLHttpRequest();
oReq.addEventListener("load", freqListener);
oReq.open("GET", base_url + "/f");
oReq.send();

</script>
</head>

<body onload="ready()">

<table border="0">
<input type="button" value="Power On" onClick="javascript:powerOn(); javascript:refresh();">
<br><br>
<input type="button" value="RX Band Up" onClick="javascript:bandUp(); javascript:refresh();">
<br><br>
<input type="button" value="RX Band Down" onClick="javascript:bandDown(); javascript:refresh();">
<br><br>
	<tr>
		<td>
			VFO A:
		</td>
		<td>
			<div id="scrollDivA"></div>
		</td>
	</tr>
	<tr>
		<td>
			VFO B:
		</td>
		<td>
			<div id="scrollDivB"></div>
		</td>
	</tr>
</table>
<br>
<input type="button" value="Clone VFO A -> VFO B" onClick="javascript:cloneVFO(); javascript:refresh();">
<br>
<br />
<div id="vfoInfo"></div>
<br />

<table border="1">
<tr>
	<td>Call</td><td><input type="text" name="call" id="call" value="WW4N"></td><td><input type="button" value="Send" onClick="javascript:sendCall()"></td>
</tr>
<tr>
	<td>Report</td><td><input type="text" name="report" id="report" value="R 5NN TU"></td><td><input type="button" value="Send" onClick="javascript:sendReport()"></td>
</tr>
<tr><td>
<div id="swrColor"></div>
</td>
<td>
<div id="swrInfo"></div>
</td>
<td>
<input type="button" value="Tune" onClick="javascript:tune()">
</td>
<tr>
<td>CW Speed</td>
<td><input type="text" name="speed" id="speed" value="TBD"></td>
<td><input type="button" value="Set" onClick="javascript:CWSpeed()"></td>
</tr>
<tr>
<td>Set VFO A Freq</td>
<td><input type="text" name="setVFOA" id="setVFOA" value="TBD"></td>
<td><input type="button" value="Set" onClick="javascript:SetVFOA(); javascript:refresh();"></td>
</tr>
<tr>
<td>Set VFO B Freq</td>
<td><input type="text" name="setVFOB" id="setVFOB" value="TBD"></td>
<td><input type="button" value="Set" onClick="javascript:SetVFOB(); javascript:refresh();"></td>
</tr>
</tr>
</table>
<br />
<input type="button" value="Toggle VFO" onClick="javascript:toggleVFO()">
<br />
<br />
<input type="button" value="Toggle Vox" onClick="javascript:toggleVox()">
<br />
<br />
<input type="button" value="Toggle CWR" onClick="javascript:toggleCWR()">
<br />
<br />

</body>
</html>
